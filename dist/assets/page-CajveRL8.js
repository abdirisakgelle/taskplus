import{r as o,u as I,j as e,a as q,b as z,N as L,d as R,I as f,m as v}from"./index-AWqnUruu.js";import{u as _}from"./index.esm-B9hW1Xzn.js";import{o as V}from"./yup-BbvBMYLW.js";import{c as G,a as U}from"./index.esm-C8qn406s.js";import{P as Y}from"./PageTitle-BMea1XiK.js";import{C as b}from"./Card-Flgoo5n_.js";import{B as c}from"./Button-BMCNuBN9.js";import{T as J}from"./Table-Cwpwlijb.js";import{M as s}from"./Modal-DmG9wn3P.js";import{F as g}from"./Form-CPHJP7Tx.js";import{A as K}from"./Alert-R2M-oA_u.js";import"./divWithClassName-BSgXz21C.js";import"./Button-Du7OjY40.js";import"./useWindow-DQikT-kc.js";import"./AbstractModalHeader-BKbYP-E5.js";import"./usePrevious-1mlFE_di.js";import"./hasClass-Du_ELl1y.js";import"./NoopTransition-BhvC9FAz.js";import"./DataKey-COGXBUcQ.js";import"./FormCheck-Dmpzi0OY.js";import"./Feedback-Cn9lSxjb.js";import"./FormContext-D8-zCC-R.js";import"./ElementChildren-C7GHKQyg.js";import"./FormControl-B6k3yqbp.js";import"./FormGroup-BKflq_TQ.js";import"./FormLabel-BzpZvh0K.js";import"./FormSelect-xdApA8jE.js";import"./FormText-HeKAsi0I.js";import"./hook-CWbxctkg.js";import"./extends-CF3RwP-h.js";import"./Anchor-C9acTcZK.js";const y=o.forwardRef(({bsPrefix:a,variant:m,animation:d="border",size:l,as:u="div",className:r,...p},x)=>{a=I(a,"spinner");const n=`${a}-${d}`;return e.jsx(u,{ref:x,...p,className:q(r,n,l&&`${n}-${l}`,m&&`text-${m}`)})});y.displayName="Spinner";const O=({perm:a,children:m,fallback:d=null})=>{const{hasPermission:l,loading:u,isAuthenticated:r}=z();return u?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:e.jsx(y,{})}):r?l(a)?m:d||e.jsxs("div",{className:"text-center p-4",children:[e.jsx("h4",{children:"Access Denied"}),e.jsx("p",{children:"You don't have permission to view this page."})]}):e.jsx(L,{to:"/auth/sign-in",replace:!0})},Q=G({name:U().min(2,"Name must be at least 2 characters").required("Name is required")}),ke=()=>{var k;const[a,m]=o.useState([]),[d,l]=o.useState(!0),[u,r]=o.useState(!1),[p,x]=o.useState(null),[n,j]=o.useState(null),[N,B]=o.useState({page:1,limit:20,total:0}),{showNotification:h}=R(),{register:F,handleSubmit:E,reset:S,setValue:$,formState:{errors:C,isSubmitting:w}}=_({resolver:V(Q),defaultValues:{name:""}}),D=async(t=1)=>{try{l(!0);const i=await v.getDepartments({page:t,limit:N.limit});m(i.data),B(T=>({...T,...i.meta}))}catch(i){h({message:i.message,variant:"danger"})}finally{l(!1)}},H=async t=>{try{p?(await v.updateDepartment(p._id,t),h({message:"Department updated successfully",variant:"success"})):(await v.createDepartment(t),h({message:"Department created successfully",variant:"success"})),r(!1),x(null),S(),D(N.page)}catch(i){h({message:i.message,variant:"danger"})}},M=t=>{x(t),$("name",t.name),r(!0)},P=async t=>{try{await v.deleteDepartment(t._id),h({message:"Department deleted successfully",variant:"success"}),j(null),D(N.page)}catch(i){h({message:i.message,variant:"danger"}),j(null)}},A=()=>{r(!1),x(null),S()};return o.useEffect(()=>{D()},[]),e.jsxs(O,{perm:"management.departments",children:[e.jsx(Y,{title:"Departments"}),e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs(b,{children:[e.jsxs(b.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"card-title mb-0",children:"Departments"}),e.jsxs(c,{variant:"primary",onClick:()=>r(!0),size:"sm",children:[e.jsx(f,{icon:"solar:add-circle-broken",className:"me-1"}),"Add Department"]})]}),e.jsx(b.Body,{children:d?e.jsx("div",{className:"text-center py-4",children:e.jsx(y,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsxs(J,{responsive:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:a.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.name}),e.jsx("td",{children:new Date(t.createdAt).toLocaleDateString()}),e.jsxs("td",{children:[e.jsx(c,{variant:"outline-primary",size:"sm",className:"me-1",onClick:()=>M(t),children:e.jsx(f,{icon:"solar:pen-broken"})}),e.jsx(c,{variant:"outline-danger",size:"sm",onClick:()=>j(t),children:e.jsx(f,{icon:"solar:trash-bin-minimalistic-broken"})})]})]},t._id))})]}),a.length===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:"No departments found"})})]})})]})})})}),e.jsxs(s,{show:u,onHide:A,children:[e.jsx(s.Header,{closeButton:!0,children:e.jsx(s.Title,{children:p?"Edit Department":"Add Department"})}),e.jsxs(g,{onSubmit:E(H),children:[e.jsx(s.Body,{children:e.jsxs(g.Group,{className:"mb-3",children:[e.jsx(g.Label,{children:"Department Name"}),e.jsx(g.Control,{type:"text",placeholder:"Enter department name",...F("name"),isInvalid:!!C.name}),e.jsx(g.Control.Feedback,{type:"invalid",children:(k=C.name)==null?void 0:k.message})]})}),e.jsxs(s.Footer,{children:[e.jsx(c,{variant:"secondary",onClick:A,children:"Cancel"}),e.jsx(c,{variant:"primary",type:"submit",disabled:w,children:w?e.jsxs(e.Fragment,{children:[e.jsx(y,{animation:"border",size:"sm",className:"me-1"}),"Saving..."]}):p?"Update":"Create"})]})]})]}),e.jsxs(s,{show:!!n,onHide:()=>j(null),children:[e.jsx(s.Header,{closeButton:!0,children:e.jsx(s.Title,{children:"Confirm Delete"})}),e.jsx(s.Body,{children:e.jsxs(K,{variant:"warning",children:[e.jsx(f,{icon:"solar:danger-triangle-broken",className:"me-2"}),'Are you sure you want to delete "',n==null?void 0:n.name,'"?',e.jsx("br",{}),e.jsx("small",{children:"This action cannot be undone."})]})}),e.jsxs(s.Footer,{children:[e.jsx(c,{variant:"secondary",onClick:()=>j(null),children:"Cancel"}),e.jsx(c,{variant:"danger",onClick:()=>P(n),children:"Delete"})]})]})]})};export{ke as default};
