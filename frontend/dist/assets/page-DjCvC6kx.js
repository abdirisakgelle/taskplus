import{r as i,u as ie,j as e,R as x,C as l,I as S,m as j}from"./index-g8JsAD6D.js";import{u as re}from"./index.esm-Cfe9nLvb.js";import{o as ae}from"./yup-BHJ-2GYf.js";import{c as le,a as u}from"./index.esm-Bj2yPUZr.js";import{P as de}from"./PageTitle-CxfJYhSt.js";import{R as oe,S as V}from"./ProtectedRoute-D3CIokNI.js";import{C as F}from"./Card-BeXcCZYv.js";import{B as m}from"./Button-D0PIrq1X.js";import{F as s}from"./Form-D1-JPNIV.js";import{T as ce}from"./Table-D3ZYodCp.js";import{B as me}from"./Badge-CntnA0Ph.js";import{M as d}from"./Modal-Cvx46NO8.js";import{A as he}from"./Alert-BnMkXQPz.js";import"./divWithClassName-DiLhEsAW.js";import"./Button-gQG5sY8T.js";import"./FormCheck-VkeX_5_i.js";import"./Feedback-DRxK_Gi1.js";import"./FormContext-pFRdsTk3.js";import"./ElementChildren-Dnw0Ivgz.js";import"./FormControl-DPlcBO7X.js";import"./FormGroup-B98vKDZp.js";import"./FormLabel-B437T1BD.js";import"./FormSelect-BKoOn0HX.js";import"./FormText-e0bnF0FN.js";import"./useWindow-cWk2CfsH.js";import"./AbstractModalHeader-zy_kemPz.js";import"./usePrevious-Ca2Tyhmu.js";import"./hasClass-aNsJJZVs.js";import"./NoopTransition-Zj_9YN3c.js";import"./DataKey-COGXBUcQ.js";import"./hook-DXU0U8PY.js";import"./extends-CF3RwP-h.js";import"./Anchor-B7CPyDu2.js";const pe=le({name:u().min(2,"Name must be at least 2 characters").required("Name is required"),shift:u().oneOf(["Morning","Afternoon","Night"],"Invalid shift"),title:u(),phone:u(),departmentId:u().required("Department is required"),sectionId:u().required("Section is required")}),Oe=()=>{var q,G,z,H,R,U;const[k,$]=i.useState([]),[D,J]=i.useState([]),[_,v]=i.useState([]),[O,A]=i.useState(!0),[K,I]=i.useState(!1),[y,N]=i.useState(null),[g,f]=i.useState(null),[C,Q]=i.useState({page:1,limit:20,total:0}),[r,B]=i.useState({departmentId:"",sectionId:""}),{showNotification:h}=ie(),{register:p,handleSubmit:W,reset:M,setValue:c,watch:X,formState:{errors:a,isSubmitting:L}}=re({resolver:ae(pe),defaultValues:{name:"",shift:"",title:"",phone:"",departmentId:"",sectionId:""}}),b=X("departmentId"),Y=async()=>{try{const t=await j.getDepartments({page:1,limit:100});J(t.data)}catch(t){console.error("Failed to load departments:",t)}},E=async(t=null)=>{if(!t){v([]);return}try{const n=await j.getSections({departmentId:t,page:1,limit:100});v(n.data)}catch(n){console.error("Failed to load sections:",n),v([])}},w=async(t=1)=>{try{A(!0);const n={page:t,limit:C.limit};r.departmentId&&(n.departmentId=r.departmentId),r.sectionId&&(n.sectionId=r.sectionId);const o=await j.getEmployees(n);$(o.data),Q(ne=>({...ne,...o.meta}))}catch(n){h({message:n.message,variant:"danger"})}finally{A(!1)}},Z=async t=>{try{y?(await j.updateEmployee(y._id,t),h({message:"Employee updated successfully",variant:"success"})):(await j.createEmployee(t),h({message:"Employee created successfully",variant:"success"})),I(!1),N(null),M(),w(C.page)}catch(n){h({message:n.message,variant:"danger"})}},ee=t=>{N(t),c("name",t.name),c("shift",t.shift||""),c("title",t.title||""),c("phone",t.phone||""),c("departmentId",t.departmentId._id),c("sectionId",t.sectionId._id),E(t.departmentId._id),I(!0)},te=async t=>{try{await j.deleteEmployee(t._id),h({message:"Employee deleted successfully",variant:"success"}),f(null),w(C.page)}catch(n){h({message:n.message,variant:"danger"}),f(null)}},P=()=>{I(!1),N(null),v([]),M()},T=async(t,n)=>{B(o=>({...o,[t]:n})),t==="departmentId"&&B(o=>({...o,sectionId:""}))},se=t=>{switch(t){case"Morning":return"success";case"Afternoon":return"warning";case"Night":return"info";default:return"secondary"}};return i.useEffect(()=>{b&&(E(b),c("sectionId",""))},[b,c]),i.useEffect(()=>{r.departmentId&&E(r.departmentId)},[r.departmentId]),i.useEffect(()=>{Y()},[]),i.useEffect(()=>{w()},[r.departmentId,r.sectionId]),e.jsxs(oe,{perm:"management.employees",children:[e.jsx(de,{title:"Employees"}),e.jsx("div",{className:"container-fluid",children:e.jsx(x,{children:e.jsx(l,{children:e.jsxs(F,{children:[e.jsx(F.Header,{children:e.jsxs(x,{className:"align-items-center",children:[e.jsx(l,{children:e.jsx("h4",{className:"card-title mb-0",children:"Employees"})}),e.jsx(l,{xs:"auto",children:e.jsxs(m,{variant:"primary",onClick:()=>I(!0),size:"sm",children:[e.jsx(S,{icon:"solar:add-circle-broken",className:"me-1"}),"Add Employee"]})})]})}),e.jsxs(F.Body,{children:[e.jsxs(x,{className:"mb-3",children:[e.jsxs(l,{md:4,children:[e.jsx(s.Label,{children:"Filter by Department"}),e.jsxs(s.Select,{value:r.departmentId,onChange:t=>T("departmentId",t.target.value),children:[e.jsx("option",{value:"",children:"All Departments"}),D.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]}),e.jsxs(l,{md:4,children:[e.jsx(s.Label,{children:"Filter by Section"}),e.jsxs(s.Select,{value:r.sectionId,onChange:t=>T("sectionId",t.target.value),disabled:!r.departmentId,children:[e.jsx("option",{value:"",children:"All Sections"}),_.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]})]}),O?e.jsx("div",{className:"text-center py-4",children:e.jsx(V,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsxs(ce,{responsive:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Shift"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Department"}),e.jsx("th",{children:"Section"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:k.map(t=>{var n,o;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("strong",{children:t.name}),t.employee_id&&e.jsxs("small",{className:"text-muted d-block",children:["ID: ",t.employee_id]})]})}),e.jsx("td",{children:t.shift&&e.jsx(me,{bg:se(t.shift),children:t.shift})}),e.jsx("td",{children:t.title||"-"}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-primary-subtle text-primary",children:((n=t.departmentId)==null?void 0:n.name)||"Unknown"})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-secondary-subtle text-secondary",children:((o=t.sectionId)==null?void 0:o.name)||"Unknown"})}),e.jsx("td",{children:t.phone||"-"}),e.jsxs("td",{children:[e.jsx(m,{variant:"outline-primary",size:"sm",className:"me-1",onClick:()=>ee(t),children:e.jsx(S,{icon:"solar:pen-broken"})}),e.jsx(m,{variant:"outline-danger",size:"sm",onClick:()=>f(t),children:e.jsx(S,{icon:"solar:trash-bin-minimalistic-broken"})})]})]},t._id)})})]}),k.length===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:"No employees found"})})]})]})]})})})}),e.jsxs(d,{show:K,onHide:P,size:"lg",children:[e.jsx(d.Header,{closeButton:!0,children:e.jsx(d.Title,{children:y?"Edit Employee":"Add Employee"})}),e.jsxs(s,{onSubmit:W(Z),children:[e.jsxs(d.Body,{children:[e.jsxs(x,{children:[e.jsx(l,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Full Name"}),e.jsx(s.Control,{type:"text",placeholder:"Enter full name",...p("name"),isInvalid:!!a.name}),e.jsx(s.Control.Feedback,{type:"invalid",children:(q=a.name)==null?void 0:q.message})]})}),e.jsx(l,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Shift"}),e.jsxs(s.Select,{...p("shift"),isInvalid:!!a.shift,children:[e.jsx("option",{value:"",children:"Select Shift"}),e.jsx("option",{value:"Morning",children:"Morning"}),e.jsx("option",{value:"Afternoon",children:"Afternoon"}),e.jsx("option",{value:"Night",children:"Night"})]}),e.jsx(s.Control.Feedback,{type:"invalid",children:(G=a.shift)==null?void 0:G.message})]})})]}),e.jsxs(x,{children:[e.jsx(l,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Title"}),e.jsx(s.Control,{type:"text",placeholder:"Job title",...p("title"),isInvalid:!!a.title}),e.jsx(s.Control.Feedback,{type:"invalid",children:(z=a.title)==null?void 0:z.message})]})}),e.jsx(l,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Phone"}),e.jsx(s.Control,{type:"text",placeholder:"Phone number",...p("phone"),isInvalid:!!a.phone}),e.jsx(s.Control.Feedback,{type:"invalid",children:(H=a.phone)==null?void 0:H.message})]})})]}),e.jsxs(x,{children:[e.jsx(l,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Department"}),e.jsxs(s.Select,{...p("departmentId"),isInvalid:!!a.departmentId,children:[e.jsx("option",{value:"",children:"Select Department"}),D.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]}),e.jsx(s.Control.Feedback,{type:"invalid",children:(R=a.departmentId)==null?void 0:R.message})]})}),e.jsx(l,{md:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Section"}),e.jsxs(s.Select,{...p("sectionId"),disabled:!b,isInvalid:!!a.sectionId,children:[e.jsx("option",{value:"",children:"Select Section"}),_.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]}),e.jsx(s.Control.Feedback,{type:"invalid",children:(U=a.sectionId)==null?void 0:U.message}),!b&&e.jsx(s.Text,{className:"text-muted",children:"Select a department first"})]})})]})]}),e.jsxs(d.Footer,{children:[e.jsx(m,{variant:"secondary",onClick:P,children:"Cancel"}),e.jsx(m,{variant:"primary",type:"submit",disabled:L,children:L?e.jsxs(e.Fragment,{children:[e.jsx(V,{animation:"border",size:"sm",className:"me-1"}),"Saving..."]}):y?"Update":"Create"})]})]})]}),e.jsxs(d,{show:!!g,onHide:()=>f(null),children:[e.jsx(d.Header,{closeButton:!0,children:e.jsx(d.Title,{children:"Confirm Delete"})}),e.jsx(d.Body,{children:e.jsxs(he,{variant:"warning",children:[e.jsx(S,{icon:"solar:danger-triangle-broken",className:"me-2"}),'Are you sure you want to delete "',g==null?void 0:g.name,'"?',e.jsx("br",{}),e.jsx("small",{children:"This action cannot be undone."})]})}),e.jsxs(d.Footer,{children:[e.jsx(m,{variant:"secondary",onClick:()=>f(null),children:"Cancel"}),e.jsx(m,{variant:"danger",onClick:()=>te(g),children:"Delete"})]})]})]})};export{Oe as default};
