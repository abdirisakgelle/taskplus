import{r as d,u as re,j as e,R as j,C as n,I as y,m as b}from"./index-g8JsAD6D.js";import{u as te}from"./index.esm-Cfe9nLvb.js";import{o as ie}from"./yup-BHJ-2GYf.js";import{c as T,a as c,b as _}from"./index.esm-Bj2yPUZr.js";import{P as ne}from"./PageTitle-CxfJYhSt.js";import{R as le,S as z}from"./ProtectedRoute-D3CIokNI.js";import{C as I}from"./Card-BeXcCZYv.js";import{B as u}from"./Button-D0PIrq1X.js";import{F as a}from"./Form-D1-JPNIV.js";import{T as de}from"./Table-D3ZYodCp.js";import{B as oe}from"./Badge-CntnA0Ph.js";import{M as o}from"./Modal-Cvx46NO8.js";import{A as H}from"./Alert-BnMkXQPz.js";import"./divWithClassName-DiLhEsAW.js";import"./Button-gQG5sY8T.js";import"./FormCheck-VkeX_5_i.js";import"./Feedback-DRxK_Gi1.js";import"./FormContext-pFRdsTk3.js";import"./ElementChildren-Dnw0Ivgz.js";import"./FormControl-DPlcBO7X.js";import"./FormGroup-B98vKDZp.js";import"./FormLabel-B437T1BD.js";import"./FormSelect-BKoOn0HX.js";import"./FormText-e0bnF0FN.js";import"./useWindow-cWk2CfsH.js";import"./AbstractModalHeader-zy_kemPz.js";import"./usePrevious-Ca2Tyhmu.js";import"./hasClass-aNsJJZVs.js";import"./NoopTransition-Zj_9YN3c.js";import"./DataKey-COGXBUcQ.js";import"./hook-DXU0U8PY.js";import"./extends-CF3RwP-h.js";import"./Anchor-B7CPyDu2.js";const ce=T({username:c().min(3,"Username must be at least 3 characters").required("Username is required"),email:c().email("Invalid email format").required("Email is required"),password:c().min(8,"Password must be at least 8 characters").required("Password is required"),confirmPassword:c().oneOf([_("password")],"Passwords must match").required("Confirm password is required"),employeeId:c().required("Employee is required")}),me=T({username:c().min(3,"Username must be at least 3 characters").required("Username is required"),email:c().email("Invalid email format").required("Email is required"),password:c().min(8,"Password must be at least 8 characters"),confirmPassword:c().when("password",{is:m=>m&&m.length>0,then:m=>m.oneOf([_("password")],"Passwords must match").required("Confirm password is required"),otherwise:m=>m.notRequired()}),status:c().oneOf(["active","disabled"],"Invalid status")}),Je=()=>{var A,D,B,G,M,R;const[m,O]=d.useState([]),[C,V]=d.useState([]),[$,E]=d.useState(!0),[S,w]=d.useState(!1),[t,U]=d.useState(null),[g,v]=d.useState(null),[N,J]=d.useState({page:1,limit:20,total:0}),[h,K]=d.useState({status:"",q:""}),{showNotification:x}=re(),Q=!!t?me:ce,{register:p,handleSubmit:W,reset:k,setValue:f,watch:ue,formState:{errors:i,isSubmitting:P}}=te({resolver:ie(Q),defaultValues:{username:"",email:"",password:"",confirmPassword:"",employeeId:"",status:"active"}}),X=async()=>{try{const s=await b.getUnassignedEmployees();V(s.data)}catch(s){console.error("Failed to load unassigned employees:",s)}},q=async(s=1)=>{try{E(!0);const r={page:s,limit:N.limit};h.status&&(r.status=h.status),h.q&&(r.q=h.q);const l=await b.getUsers(r);O(l.data),J(ae=>({...ae,...l.meta}))}catch(r){x({message:r.message,variant:"danger"})}finally{E(!1)}},Y=async s=>{try{const r={...s};delete r.confirmPassword,t?(r.password||delete r.password,await b.updateUser(t._id,r),x({message:"User updated successfully",variant:"success"})):(await b.createUser(r),x({message:"User created successfully",variant:"success"})),w(!1),U(null),k(),q(N.page)}catch(r){x({message:r.message,variant:"danger"})}},Z=s=>{U(s),f("username",s.username),f("email",s.email),f("status",s.status),f("password",""),f("confirmPassword",""),w(!0)},ee=async s=>{try{await b.deleteUser(s._id),x({message:"User deleted successfully",variant:"success"}),v(null),q(N.page)}catch(r){x({message:r.message,variant:"danger"}),v(null)}},F=()=>{w(!1),U(null),k()},L=(s,r)=>{K(l=>({...l,[s]:r}))},se=s=>{switch(s){case"active":return"success";case"disabled":return"danger";default:return"secondary"}};return d.useEffect(()=>{S&&!t&&X()},[S,t]),d.useEffect(()=>{q()},[h.status,h.q]),e.jsxs(le,{perm:"management.users",children:[e.jsx(ne,{title:"Users"}),e.jsx("div",{className:"container-fluid",children:e.jsx(j,{children:e.jsx(n,{children:e.jsxs(I,{children:[e.jsx(I.Header,{children:e.jsxs(j,{className:"align-items-center",children:[e.jsx(n,{children:e.jsx("h4",{className:"card-title mb-0",children:"Users"})}),e.jsx(n,{xs:"auto",children:e.jsxs(u,{variant:"primary",onClick:()=>w(!0),size:"sm",children:[e.jsx(y,{icon:"solar:add-circle-broken",className:"me-1"}),"Add User"]})})]})}),e.jsxs(I.Body,{children:[e.jsxs(j,{className:"mb-3",children:[e.jsxs(n,{md:4,children:[e.jsx(a.Label,{children:"Filter by Status"}),e.jsxs(a.Select,{value:h.status,onChange:s=>L("status",s.target.value),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"disabled",children:"Disabled"})]})]}),e.jsxs(n,{md:4,children:[e.jsx(a.Label,{children:"Search"}),e.jsx(a.Control,{type:"text",placeholder:"Search username or email...",value:h.q,onChange:s=>L("q",s.target.value)})]})]}),$?e.jsx("div",{className:"text-center py-4",children:e.jsx(z,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsxs(de,{responsive:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Employee"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Last Login"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:m.map(s=>{var r,l;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:s.username})}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.employeeId?e.jsxs("div",{children:[e.jsx("div",{children:s.employeeId.name}),e.jsxs("small",{className:"text-muted",children:[(r=s.employeeId.departmentId)==null?void 0:r.name," • ",(l=s.employeeId.sectionId)==null?void 0:l.name]})]}):e.jsx("span",{className:"text-muted",children:"No employee linked"})}),e.jsx("td",{children:e.jsx(oe,{bg:se(s.status),children:s.status})}),e.jsx("td",{children:s.lastLogin?new Date(s.lastLogin).toLocaleDateString():e.jsx("span",{className:"text-muted",children:"Never"})}),e.jsx("td",{children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("td",{children:[e.jsx(u,{variant:"outline-primary",size:"sm",className:"me-1",onClick:()=>Z(s),children:e.jsx(y,{icon:"solar:pen-broken"})}),e.jsx(u,{variant:"outline-danger",size:"sm",onClick:()=>v(s),children:e.jsx(y,{icon:"solar:trash-bin-minimalistic-broken"})})]})]},s._id)})})]}),m.length===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:"No users found"})})]})]})]})})})}),e.jsxs(o,{show:S,onHide:F,size:"lg",children:[e.jsx(o.Header,{closeButton:!0,children:e.jsx(o.Title,{children:t?"Edit User":"Add User"})}),e.jsxs(a,{onSubmit:W(Y),children:[e.jsxs(o.Body,{children:[e.jsxs(j,{children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Username"}),e.jsx(a.Control,{type:"text",placeholder:"Enter username",...p("username"),isInvalid:!!i.username}),e.jsx(a.Control.Feedback,{type:"invalid",children:(A=i.username)==null?void 0:A.message})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Email"}),e.jsx(a.Control,{type:"email",placeholder:"Enter email",...p("email"),isInvalid:!!i.email}),e.jsx(a.Control.Feedback,{type:"invalid",children:(D=i.email)==null?void 0:D.message})]})})]}),e.jsxs(j,{children:[e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsxs(a.Label,{children:["Password ",t&&"(leave blank to keep current)"]}),e.jsx(a.Control,{type:"password",placeholder:"Enter password",...p("password"),isInvalid:!!i.password}),e.jsx(a.Control.Feedback,{type:"invalid",children:(B=i.password)==null?void 0:B.message})]})}),e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Confirm Password"}),e.jsx(a.Control,{type:"password",placeholder:"Confirm password",...p("confirmPassword"),isInvalid:!!i.confirmPassword}),e.jsx(a.Control.Feedback,{type:"invalid",children:(G=i.confirmPassword)==null?void 0:G.message})]})})]}),e.jsxs(j,{children:[!t&&e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Employee"}),e.jsxs(a.Select,{...p("employeeId"),isInvalid:!!i.employeeId,children:[e.jsx("option",{value:"",children:"Select Employee"}),C.map(s=>{var r,l;return e.jsxs("option",{value:s._id,children:[s.name," - ",(r=s.departmentId)==null?void 0:r.name," • ",(l=s.sectionId)==null?void 0:l.name]},s._id)})]}),e.jsx(a.Control.Feedback,{type:"invalid",children:(M=i.employeeId)==null?void 0:M.message})]})}),t&&e.jsx(n,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Status"}),e.jsxs(a.Select,{...p("status"),isInvalid:!!i.status,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"disabled",children:"Disabled"})]}),e.jsx(a.Control.Feedback,{type:"invalid",children:(R=i.status)==null?void 0:R.message})]})})]}),!t&&C.length===0&&e.jsxs(H,{variant:"warning",children:[e.jsx(y,{icon:"solar:info-circle-broken",className:"me-2"}),"No unassigned employees available. All employees already have user accounts."]})]}),e.jsxs(o.Footer,{children:[e.jsx(u,{variant:"secondary",onClick:F,children:"Cancel"}),e.jsx(u,{variant:"primary",type:"submit",disabled:P||!t&&C.length===0,children:P?e.jsxs(e.Fragment,{children:[e.jsx(z,{animation:"border",size:"sm",className:"me-1"}),"Saving..."]}):t?"Update":"Create"})]})]})]}),e.jsxs(o,{show:!!g,onHide:()=>v(null),children:[e.jsx(o.Header,{closeButton:!0,children:e.jsx(o.Title,{children:"Confirm Delete"})}),e.jsx(o.Body,{children:e.jsxs(H,{variant:"warning",children:[e.jsx(y,{icon:"solar:danger-triangle-broken",className:"me-2"}),'Are you sure you want to delete user "',g==null?void 0:g.username,'"?',e.jsx("br",{}),e.jsx("small",{children:"This action cannot be undone."})]})}),e.jsxs(o.Footer,{children:[e.jsx(u,{variant:"secondary",onClick:()=>v(null),children:"Cancel"}),e.jsx(u,{variant:"danger",onClick:()=>ee(g),children:"Delete"})]})]})]})};export{Je as default};
