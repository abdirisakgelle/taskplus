import{r,u as I,j as e,I as p,m as h}from"./index-g8JsAD6D.js";import{u as q}from"./index.esm-Cfe9nLvb.js";import{o as L}from"./yup-BHJ-2GYf.js";import{c as R,a as _}from"./index.esm-Bj2yPUZr.js";import{P as V}from"./PageTitle-CxfJYhSt.js";import{R as $,S}from"./ProtectedRoute-D3CIokNI.js";import{C as g}from"./Card-BeXcCZYv.js";import{B as n}from"./Button-D0PIrq1X.js";import{T as G}from"./Table-D3ZYodCp.js";import{M as s}from"./Modal-Cvx46NO8.js";import{F as m}from"./Form-D1-JPNIV.js";import{A as U}from"./Alert-BnMkXQPz.js";import"./divWithClassName-DiLhEsAW.js";import"./Button-gQG5sY8T.js";import"./useWindow-cWk2CfsH.js";import"./AbstractModalHeader-zy_kemPz.js";import"./usePrevious-Ca2Tyhmu.js";import"./hasClass-aNsJJZVs.js";import"./NoopTransition-Zj_9YN3c.js";import"./DataKey-COGXBUcQ.js";import"./FormCheck-VkeX_5_i.js";import"./Feedback-DRxK_Gi1.js";import"./FormContext-pFRdsTk3.js";import"./ElementChildren-Dnw0Ivgz.js";import"./FormControl-DPlcBO7X.js";import"./FormGroup-B98vKDZp.js";import"./FormLabel-B437T1BD.js";import"./FormSelect-BKoOn0HX.js";import"./FormText-e0bnF0FN.js";import"./hook-DXU0U8PY.js";import"./extends-CF3RwP-h.js";import"./Anchor-B7CPyDu2.js";const J=R({name:_().min(2,"Name must be at least 2 characters").required("Name is required")}),Se=()=>{var C;const[f,w]=r.useState([]),[k,y]=r.useState(!0),[A,c]=r.useState(!1),[d,u]=r.useState(null),[o,l]=r.useState(null),[x,F]=r.useState({page:1,limit:20,total:0}),{showNotification:i}=I(),{register:B,handleSubmit:E,reset:v,setValue:M,formState:{errors:D,isSubmitting:b}}=q({resolver:L(J),defaultValues:{name:""}}),j=async(t=1)=>{try{y(!0);const a=await h.getDepartments({page:t,limit:x.limit});w(a.data),F(z=>({...z,...a.meta}))}catch(a){i({message:a.message,variant:"danger"})}finally{y(!1)}},H=async t=>{try{d?(await h.updateDepartment(d._id,t),i({message:"Department updated successfully",variant:"success"})):(await h.createDepartment(t),i({message:"Department created successfully",variant:"success"})),c(!1),u(null),v(),j(x.page)}catch(a){i({message:a.message,variant:"danger"})}},P=t=>{u(t),M("name",t.name),c(!0)},T=async t=>{try{await h.deleteDepartment(t._id),i({message:"Department deleted successfully",variant:"success"}),l(null),j(x.page)}catch(a){i({message:a.message,variant:"danger"}),l(null)}},N=()=>{c(!1),u(null),v()};return r.useEffect(()=>{j()},[]),e.jsxs($,{perm:"management.departments",children:[e.jsx(V,{title:"Departments"}),e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs(g,{children:[e.jsxs(g.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"card-title mb-0",children:"Departments"}),e.jsxs(n,{variant:"primary",onClick:()=>c(!0),size:"sm",children:[e.jsx(p,{icon:"solar:add-circle-broken",className:"me-1"}),"Add Department"]})]}),e.jsx(g.Body,{children:k?e.jsx("div",{className:"text-center py-4",children:e.jsx(S,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsxs(G,{responsive:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:f.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.name}),e.jsx("td",{children:new Date(t.createdAt).toLocaleDateString()}),e.jsxs("td",{children:[e.jsx(n,{variant:"outline-primary",size:"sm",className:"me-1",onClick:()=>P(t),children:e.jsx(p,{icon:"solar:pen-broken"})}),e.jsx(n,{variant:"outline-danger",size:"sm",onClick:()=>l(t),children:e.jsx(p,{icon:"solar:trash-bin-minimalistic-broken"})})]})]},t._id))})]}),f.length===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:"No departments found"})})]})})]})})})}),e.jsxs(s,{show:A,onHide:N,children:[e.jsx(s.Header,{closeButton:!0,children:e.jsx(s.Title,{children:d?"Edit Department":"Add Department"})}),e.jsxs(m,{onSubmit:E(H),children:[e.jsx(s.Body,{children:e.jsxs(m.Group,{className:"mb-3",children:[e.jsx(m.Label,{children:"Department Name"}),e.jsx(m.Control,{type:"text",placeholder:"Enter department name",...B("name"),isInvalid:!!D.name}),e.jsx(m.Control.Feedback,{type:"invalid",children:(C=D.name)==null?void 0:C.message})]})}),e.jsxs(s.Footer,{children:[e.jsx(n,{variant:"secondary",onClick:N,children:"Cancel"}),e.jsx(n,{variant:"primary",type:"submit",disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(S,{animation:"border",size:"sm",className:"me-1"}),"Saving..."]}):d?"Update":"Create"})]})]})]}),e.jsxs(s,{show:!!o,onHide:()=>l(null),children:[e.jsx(s.Header,{closeButton:!0,children:e.jsx(s.Title,{children:"Confirm Delete"})}),e.jsx(s.Body,{children:e.jsxs(U,{variant:"warning",children:[e.jsx(p,{icon:"solar:danger-triangle-broken",className:"me-2"}),'Are you sure you want to delete "',o==null?void 0:o.name,'"?',e.jsx("br",{}),e.jsx("small",{children:"This action cannot be undone."})]})}),e.jsxs(s.Footer,{children:[e.jsx(n,{variant:"secondary",onClick:()=>l(null),children:"Cancel"}),e.jsx(n,{variant:"danger",onClick:()=>T(o),children:"Delete"})]})]})]})};export{Se as default};
