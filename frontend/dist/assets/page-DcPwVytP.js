import{r as n,u as Q,j as e,R as v,C as j,I as g,m}from"./index-g8JsAD6D.js";import{u as W}from"./index.esm-Cfe9nLvb.js";import{o as X}from"./yup-BHJ-2GYf.js";import{c as Y,a as M}from"./index.esm-Bj2yPUZr.js";import{P as Z}from"./PageTitle-CxfJYhSt.js";import{R as ee,S as q}from"./ProtectedRoute-D3CIokNI.js";import{C as b}from"./Card-BeXcCZYv.js";import{B as o}from"./Button-D0PIrq1X.js";import{F as a}from"./Form-D1-JPNIV.js";import{T as te}from"./Table-D3ZYodCp.js";import{M as r}from"./Modal-Cvx46NO8.js";import{A as se}from"./Alert-BnMkXQPz.js";import"./divWithClassName-DiLhEsAW.js";import"./Button-gQG5sY8T.js";import"./FormCheck-VkeX_5_i.js";import"./Feedback-DRxK_Gi1.js";import"./FormContext-pFRdsTk3.js";import"./ElementChildren-Dnw0Ivgz.js";import"./FormControl-DPlcBO7X.js";import"./FormGroup-B98vKDZp.js";import"./FormLabel-B437T1BD.js";import"./FormSelect-BKoOn0HX.js";import"./FormText-e0bnF0FN.js";import"./useWindow-cWk2CfsH.js";import"./AbstractModalHeader-zy_kemPz.js";import"./usePrevious-Ca2Tyhmu.js";import"./hasClass-aNsJJZVs.js";import"./NoopTransition-Zj_9YN3c.js";import"./DataKey-COGXBUcQ.js";import"./hook-DXU0U8PY.js";import"./extends-CF3RwP-h.js";import"./Anchor-B7CPyDu2.js";const ae=Y({departmentId:M().required("Department is required"),name:M().min(2,"Name must be at least 2 characters").required("Name is required")}),Le=()=>{var E,_,B;const[I,H]=n.useState([]),[N,L]=n.useState([]),[P,C]=n.useState(!0),[R,p]=n.useState(!1),[h,S]=n.useState(null),[i,c]=n.useState(null),[f,T]=n.useState({page:1,limit:20,total:0}),[d,z]=n.useState({departmentId:""}),{showNotification:l}=Q(),{register:w,handleSubmit:G,reset:D,setValue:k,watch:ne,formState:{errors:x,isSubmitting:F}}=W({resolver:X(ae),defaultValues:{departmentId:"",name:""}}),U=async()=>{try{const t=await m.getDepartments({page:1,limit:100});L(t.data)}catch(t){console.error("Failed to load departments:",t)}},y=async(t=1)=>{try{C(!0);const s={page:t,limit:f.limit};d.departmentId&&(s.departmentId=d.departmentId);const u=await m.getSections(s);H(u.data),T(O=>({...O,...u.meta}))}catch(s){l({message:s.message,variant:"danger"})}finally{C(!1)}},V=async t=>{try{h?(await m.updateSection(h._id,t),l({message:"Section updated successfully",variant:"success"})):(await m.createSection(t),l({message:"Section created successfully",variant:"success"})),p(!1),S(null),D(),y(f.page)}catch(s){l({message:s.message,variant:"danger"})}},$=t=>{S(t),k("departmentId",t.departmentId._id),k("name",t.name),p(!0)},J=async t=>{try{await m.deleteSection(t._id),l({message:"Section deleted successfully",variant:"success"}),c(null),y(f.page)}catch(s){l({message:s.message,variant:"danger"}),c(null)}},A=()=>{p(!1),S(null),D()},K=(t,s)=>{z(u=>({...u,[t]:s}))};return n.useEffect(()=>{U()},[]),n.useEffect(()=>{y()},[d.departmentId]),e.jsxs(ee,{perm:"management.sections",children:[e.jsx(Z,{title:"Sections"}),e.jsx("div",{className:"container-fluid",children:e.jsx(v,{children:e.jsx(j,{children:e.jsxs(b,{children:[e.jsx(b.Header,{children:e.jsxs(v,{className:"align-items-center",children:[e.jsx(j,{children:e.jsx("h4",{className:"card-title mb-0",children:"Sections"})}),e.jsx(j,{xs:"auto",children:e.jsxs(o,{variant:"primary",onClick:()=>p(!0),size:"sm",children:[e.jsx(g,{icon:"solar:add-circle-broken",className:"me-1"}),"Add Section"]})})]})}),e.jsxs(b.Body,{children:[e.jsx(v,{className:"mb-3",children:e.jsxs(j,{md:4,children:[e.jsx(a.Label,{children:"Filter by Department"}),e.jsxs(a.Select,{value:d.departmentId,onChange:t=>K("departmentId",t.target.value),children:[e.jsx("option",{value:"",children:"All Departments"}),N.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]})]})}),P?e.jsx("div",{className:"text-center py-4",children:e.jsx(q,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsxs(te,{responsive:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Department"}),e.jsx("th",{children:"Section Name"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:I.map(t=>{var s;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"badge bg-primary-subtle text-primary",children:((s=t.departmentId)==null?void 0:s.name)||"Unknown"})}),e.jsx("td",{children:t.name}),e.jsx("td",{children:new Date(t.createdAt).toLocaleDateString()}),e.jsxs("td",{children:[e.jsx(o,{variant:"outline-primary",size:"sm",className:"me-1",onClick:()=>$(t),children:e.jsx(g,{icon:"solar:pen-broken"})}),e.jsx(o,{variant:"outline-danger",size:"sm",onClick:()=>c(t),children:e.jsx(g,{icon:"solar:trash-bin-minimalistic-broken"})})]})]},t._id)})})]}),I.length===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:d.departmentId?"No sections found in selected department":"No sections found"})})]})]})]})})})}),e.jsxs(r,{show:R,onHide:A,children:[e.jsx(r.Header,{closeButton:!0,children:e.jsx(r.Title,{children:h?"Edit Section":"Add Section"})}),e.jsxs(a,{onSubmit:G(V),children:[e.jsxs(r.Body,{children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Department"}),e.jsxs(a.Select,{...w("departmentId"),isInvalid:!!x.departmentId,children:[e.jsx("option",{value:"",children:"Select Department"}),N.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))]}),e.jsx(a.Control.Feedback,{type:"invalid",children:(E=x.departmentId)==null?void 0:E.message})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Section Name"}),e.jsx(a.Control,{type:"text",placeholder:"Enter section name",...w("name"),isInvalid:!!x.name}),e.jsx(a.Control.Feedback,{type:"invalid",children:(_=x.name)==null?void 0:_.message})]})]}),e.jsxs(r.Footer,{children:[e.jsx(o,{variant:"secondary",onClick:A,children:"Cancel"}),e.jsx(o,{variant:"primary",type:"submit",disabled:F,children:F?e.jsxs(e.Fragment,{children:[e.jsx(q,{animation:"border",size:"sm",className:"me-1"}),"Saving..."]}):h?"Update":"Create"})]})]})]}),e.jsxs(r,{show:!!i,onHide:()=>c(null),children:[e.jsx(r.Header,{closeButton:!0,children:e.jsx(r.Title,{children:"Confirm Delete"})}),e.jsx(r.Body,{children:e.jsxs(se,{variant:"warning",children:[e.jsx(g,{icon:"solar:danger-triangle-broken",className:"me-2"}),'Are you sure you want to delete "',i==null?void 0:i.name,'" from ',(B=i==null?void 0:i.departmentId)==null?void 0:B.name,"?",e.jsx("br",{}),e.jsx("small",{children:"This action cannot be undone."})]})}),e.jsxs(r.Footer,{children:[e.jsx(o,{variant:"secondary",onClick:()=>c(null),children:"Cancel"}),e.jsx(o,{variant:"danger",onClick:()=>J(i),children:"Delete"})]})]})]})};export{Le as default};
