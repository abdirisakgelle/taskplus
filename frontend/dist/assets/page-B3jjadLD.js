import{g as M,u as P,e as T,r as c,j as e,R as E,C as z,m as D,s as p}from"./index-g8JsAD6D.js";import{S as h}from"./sweetalert2.all-BNJhgLm2.js";import{P as I}from"./PageTitle-CxfJYhSt.js";import{C as y}from"./Card-BeXcCZYv.js";import{B as R}from"./ButtonGroup-DUyuRbvs.js";import{B as r}from"./Button-D0PIrq1X.js";import{B as o}from"./Badge-CntnA0Ph.js";import"./divWithClassName-DiLhEsAW.js";import"./Button-gQG5sY8T.js";const W=()=>{const[w,$]=M(),{showNotification:l}=P();T();const[f,_]=c.useState([]),[b,j]=c.useState(!0),[L,C]=c.useState(new Map),[d,g]=c.useState("all"),[i,u]=c.useState({page:parseInt(w.get("page"))||1,pageSize:20,total:0,pages:0});c.useEffect(()=>{(async()=>{try{const s=await D.getEmployees({pageSize:1e3}),a=new Map;s.data.forEach(n=>{a.set(n.employee_id,n.name)}),C(a)}catch(s){console.error("Failed to load employees:",s)}})()},[]);const m=async()=>{try{j(!0);const t={page:i.page,pageSize:i.pageSize};switch(d){case"awaiting":t.issue_solved="null";break;case"solved":t.issue_solved="true",t.satisfied="true";break;case"not_solved":t.issue_solved="false";break;default:break}const s=await p.getFollowUps(t);_(s.data||[]),u(a=>({...a,total:s.meta.total,pages:s.meta.pages}))}catch(t){l({message:t.message||"Failed to load follow-ups",variant:"danger"})}finally{j(!1)}};c.useEffect(()=>{m()},[i.page,d]);const x=t=>{u(s=>({...s,page:t}))},N=async t=>{const s=await h.fire({title:"Customer confirmed solved.",text:"Record satisfaction?",icon:"question",showCancelButton:!0,showDenyButton:!0,confirmButtonText:"Satisfied ðŸ˜Š",denyButtonText:"Not satisfied ðŸ˜",cancelButtonText:"Cancel",confirmButtonColor:"#28a745",denyButtonColor:"#ffc107",cancelButtonColor:"#6c757d"});if(s.isConfirmed||s.isDenied)try{await p.updateFollowUp(t.follow_up_id,{action:"solved",satisfied:s.isConfirmed,follow_up_notes:s.isConfirmed?"Customer satisfied with resolution":"Customer not satisfied with resolution"}),l({message:"Saved successfully.",variant:"success"}),m()}catch(a){l({message:a.message,variant:"danger"})}},S=async t=>{var a;(a=t.ticket_info)!=null&&a.agent_name;const s=await h.fire({title:"Customer says not solved.",text:"The ticket will reopen.",icon:"warning",input:"textarea",inputPlaceholder:"Add a note about the issue...",showCancelButton:!0,confirmButtonText:"Reopen ticket",cancelButtonText:"Cancel",confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",inputValidator:n=>{if(!n)return"Please add a note!"}});if(s.isConfirmed)try{await p.updateFollowUp(t.follow_up_id,{action:"not_solved",follow_up_notes:s.value}),l({message:"Saved successfully.",variant:"success"}),m()}catch(n){l({message:n.message,variant:"danger"})}},k=async t=>{const s=await h.fire({title:"No answer.",text:"Add a note and schedule a retry.",icon:"info",html:`
        <div class="text-start">
          <label class="form-label">Next Follow-up Date</label>
          <input id="swal-date" class="form-control mb-3" type="datetime-local" />
          <label class="form-label">Note</label>
          <textarea id="swal-note" class="form-control" rows="3" placeholder="Add note..."></textarea>
        </div>
      `,showCancelButton:!0,confirmButtonText:"Schedule",cancelButtonText:"Cancel",confirmButtonColor:"#0d6efd",cancelButtonColor:"#6c757d",preConfirm:()=>{const a=document.getElementById("swal-date").value,n=document.getElementById("swal-note").value;return(!a||!n)&&h.showValidationMessage("Please fill all fields"),{date:a,note:n}}});if(s.isConfirmed)try{await p.updateFollowUp(t.follow_up_id,{action:"no_answer",follow_up_date:s.value.date,follow_up_notes:s.value.note}),l({message:"Saved successfully.",variant:"success"}),m()}catch(a){l({message:a.message,variant:"danger"})}},B=async t=>{if((await h.fire({title:"Assign to yourself?",text:"This follow-up will be assigned to you.",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, Assign",cancelButtonText:"Cancel",confirmButtonColor:"#0d6efd",cancelButtonColor:"#6c757d"})).isConfirmed)try{await p.updateFollowUp(t.follow_up_id,{action:"assign_to_me"}),l({message:"Saved successfully.",variant:"success"}),m()}catch(a){l({message:a.message,variant:"danger"})}},F=t=>t==null?e.jsx(o,{bg:"secondary",children:"Pending"}):t?e.jsx(o,{bg:"success",children:"Solved"}):e.jsx(o,{bg:"danger",children:"Not Solved"}),A=t=>t==null?e.jsx(o,{bg:"secondary",children:"-"}):t?e.jsx(o,{bg:"success",children:"Yes"}):e.jsx(o,{bg:"warning",children:"No"});return e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"Follow-ups",breadcrumbItems:[{label:"Customer Support",path:"/support/tickets",active:!1},{label:"Follow-ups",path:"/support/follow-ups",active:!0}]}),e.jsx(E,{children:e.jsx(z,{xs:12,children:e.jsx(y,{children:e.jsxs(y.Body,{children:[e.jsx("div",{className:"mb-3",children:e.jsxs(R,{children:[e.jsx(r,{variant:d==="all"?"primary":"outline-primary",onClick:()=>{g("all"),u(t=>({...t,page:1}))},children:"All"}),e.jsx(r,{variant:d==="awaiting"?"primary":"outline-primary",onClick:()=>{g("awaiting"),u(t=>({...t,page:1}))},children:"Awaiting Feedback"}),e.jsx(r,{variant:d==="solved"?"primary":"outline-primary",onClick:()=>{g("solved"),u(t=>({...t,page:1}))},children:"Solved & Satisfied"}),e.jsx(r,{variant:d==="not_solved"?"primary":"outline-primary",onClick:()=>{g("not_solved"),u(t=>({...t,page:1}))},children:"Not Solved"})]})}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover table-nowrap mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Follow-up ID"}),e.jsx("th",{children:"Ticket ID"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Issue Category"}),e.jsx("th",{children:"Follow-up Agent"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Issue Solved"}),e.jsx("th",{children:"Satisfied"}),e.jsx("th",{children:"Repeated"}),e.jsx("th",{children:"Notes"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:b?e.jsx("tr",{children:e.jsx("td",{colSpan:"11",className:"text-center py-4",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})}):f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"11",className:"text-center py-4 text-muted",children:"No follow-ups found"})}):f.map(t=>{var s,a,n,v;return e.jsxs("tr",{children:[e.jsxs("td",{children:["#",t.follow_up_id]}),e.jsx("td",{children:e.jsxs("a",{href:`/support/tickets?ticket_id=${t.ticket_id}`,children:["#",t.ticket_id]})}),e.jsx("td",{children:((s=t.ticket_info)==null?void 0:s.customer_phone)||"-"}),e.jsx("td",{children:(a=t.ticket_info)!=null&&a.issue_category?e.jsx(o,{bg:"primary",className:"bg-opacity-10 text-primary",children:t.ticket_info.issue_category}):"-"}),e.jsx("td",{children:t.agent_name||"Unassigned"}),e.jsx("td",{children:new Date(t.follow_up_date).toLocaleString()}),e.jsx("td",{children:F(t.issue_solved)}),e.jsx("td",{children:A(t.satisfied)}),e.jsx("td",{children:t.repeated_issue?e.jsx(o,{bg:"danger",children:"Yes"}):e.jsx(o,{bg:"success",children:"No"})}),e.jsx("td",{children:e.jsxs("span",{title:t.follow_up_notes,children:[(n=t.follow_up_notes)==null?void 0:n.substring(0,30),((v=t.follow_up_notes)==null?void 0:v.length)>30&&"..."]})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-1",children:[t.issue_solved===null&&e.jsxs(e.Fragment,{children:[e.jsx(r,{size:"sm",variant:"success",onClick:()=>N(t),title:"Mark Solved",children:e.jsx("i",{className:"mdi mdi-check"})}),e.jsx(r,{size:"sm",variant:"danger",onClick:()=>S(t),title:"Mark Not Solved",children:e.jsx("i",{className:"mdi mdi-close"})}),e.jsx(r,{size:"sm",variant:"info",onClick:()=>k(t),title:"No Answer",children:e.jsx("i",{className:"mdi mdi-phone-missed"})})]}),!t.follow_up_agent_id&&e.jsx(r,{size:"sm",variant:"primary",onClick:()=>B(t),title:"Assign to Me",children:e.jsx("i",{className:"mdi mdi-account-plus"})})]})})]},t.follow_up_id)})})]})}),i.pages>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",(i.page-1)*i.pageSize+1," to"," ",Math.min(i.page*i.pageSize,i.total)," of"," ",i.total," follow-ups"]}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination mb-0",children:[e.jsx("li",{className:`page-item ${i.page===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(i.page-1),disabled:i.page===1,children:"Previous"})}),[...Array(Math.min(5,i.pages))].map((t,s)=>{const a=s+1;return e.jsx("li",{className:`page-item ${i.page===a?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(a),children:a})},s)}),e.jsx("li",{className:`page-item ${i.page===i.pages?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(i.page+1),disabled:i.page===i.pages,children:"Next"})})]})})]})]})})})})]})};export{W as default};
