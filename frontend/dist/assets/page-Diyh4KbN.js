import{f as V,r as S,g as K,u as W,j as e,R as H,C as O,m as Y,s as D}from"./index-g8JsAD6D.js";import{S as I}from"./sweetalert2.all-BNJhgLm2.js";import{P as J}from"./PageTitle-CxfJYhSt.js";import{C as $}from"./Card-BeXcCZYv.js";import{F as y}from"./Form-D1-JPNIV.js";import{B as L}from"./Button-D0PIrq1X.js";import{B as q}from"./Badge-CntnA0Ph.js";import"./divWithClassName-DiLhEsAW.js";import"./FormCheck-VkeX_5_i.js";import"./Feedback-DRxK_Gi1.js";import"./FormContext-pFRdsTk3.js";import"./ElementChildren-Dnw0Ivgz.js";import"./FormControl-DPlcBO7X.js";import"./FormGroup-B98vKDZp.js";import"./FormLabel-B437T1BD.js";import"./FormSelect-BKoOn0HX.js";import"./FormText-e0bnF0FN.js";import"./Button-gQG5sY8T.js";var Q={},F={};/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */F.parse=X;F.serialize=ee;var Z=Object.prototype.toString,z=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function X(i,f){if(typeof i!="string")throw new TypeError("argument str must be a string");for(var h={},a=f||{},C=a.decode||te,g=0;g<i.length;){var d=i.indexOf("=",g);if(d===-1)break;var v=i.indexOf(";",g);if(v===-1)v=i.length;else if(v<d){g=i.lastIndexOf(";",d-1)+1;continue}var x=i.slice(g,d).trim();if(h[x]===void 0){var b=i.slice(d+1,v).trim();b.charCodeAt(0)===34&&(b=b.slice(1,-1)),h[x]=ie(b,C)}g=v+1}return h}function ee(i,f,h){var a=h||{},C=a.encode||oe;if(typeof C!="function")throw new TypeError("option encode is invalid");if(!z.test(i))throw new TypeError("argument name is invalid");var g=C(f);if(g&&!z.test(g))throw new TypeError("argument val is invalid");var d=i+"="+g;if(a.maxAge!=null){var v=a.maxAge-0;if(isNaN(v)||!isFinite(v))throw new TypeError("option maxAge is invalid");d+="; Max-Age="+Math.floor(v)}if(a.domain){if(!z.test(a.domain))throw new TypeError("option domain is invalid");d+="; Domain="+a.domain}if(a.path){if(!z.test(a.path))throw new TypeError("option path is invalid");d+="; Path="+a.path}if(a.expires){var x=a.expires;if(!se(x)||isNaN(x.valueOf()))throw new TypeError("option expires is invalid");d+="; Expires="+x.toUTCString()}if(a.httpOnly&&(d+="; HttpOnly"),a.secure&&(d+="; Secure"),a.partitioned&&(d+="; Partitioned"),a.priority){var b=typeof a.priority=="string"?a.priority.toLowerCase():a.priority;switch(b){case"low":d+="; Priority=Low";break;case"medium":d+="; Priority=Medium";break;case"high":d+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(a.sameSite){var u=typeof a.sameSite=="string"?a.sameSite.toLowerCase():a.sameSite;switch(u){case!0:d+="; SameSite=Strict";break;case"lax":d+="; SameSite=Lax";break;case"strict":d+="; SameSite=Strict";break;case"none":d+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return d}function te(i){return i.indexOf("%")!==-1?decodeURIComponent(i):i}function oe(i){return encodeURIComponent(i)}function se(i){return Z.call(i)==="[object Date]"||i instanceof Date}function ie(i,f){try{return f(i)}catch{return i}}(function(i){var f=V&&V.__assign||function(){return f=Object.assign||function(o){for(var r,l=1,c=arguments.length;l<c;l++){r=arguments[l];for(var m in r)Object.prototype.hasOwnProperty.call(r,m)&&(o[m]=r[m])}return o},f.apply(this,arguments)},h=V&&V.__rest||function(o,r){var l={};for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&r.indexOf(c)<0&&(l[c]=o[c]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,c=Object.getOwnPropertySymbols(o);m<c.length;m++)r.indexOf(c[m])<0&&Object.prototype.propertyIsEnumerable.call(o,c[m])&&(l[c[m]]=o[c[m]]);return l};Object.defineProperty(i,"__esModule",{value:!0}),i.hasCookie=i.deleteCookie=i.setCookie=i.getCookie=i.getCookies=void 0;var a=F,C=function(){return typeof window<"u"},g=function(o){return o?"getAll"in o&&"set"in o&&typeof o.getAll=="function"&&typeof o.set=="function":!1},d=function(o){return!!(o!=null&&o.req)&&"cookies"in o.req&&g(o==null?void 0:o.req.cookies)||!!(o!=null&&o.res)&&"cookies"in o.res&&g(o==null?void 0:o.res.cookies)||!!(o!=null&&o.cookies)&&g(o.cookies())},v=function(o){var r={};return o.getAll().forEach(function(l){var c=l.name,m=l.value;r[c]=m}),r},x=function(o){try{if(typeof o=="string")return o;var r=JSON.stringify(o);return r}catch{return o}},b=function(o){return o&&o.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)},u=function(o){if(d(o)){if(o!=null&&o.req)return v(o.req.cookies);if(o!=null&&o.cookies)return v(o.cookies())}var r;if(o&&(r=o.req),!C())return r&&r.cookies?r.cookies:r&&r.headers.cookie?(0,a.parse)(r.headers.cookie):{};for(var l={},c=document.cookie?document.cookie.split("; "):[],m=0,A=c.length;m<A;m++){var N=c[m].split("="),T=N.slice(1).join("="),t=N[0];l[t]=T}return l};i.getCookies=u;var B=function(o,r){var l=(0,i.getCookies)(r),c=l[o];if(c!==void 0)return b(c)};i.getCookie=B;var w=function(o,r,l){if(d(l)){var c=l.req,m=l.res,A=l.cookies,N=h(l,["req","res","cookies"]),T=f({name:o,value:x(r)},N);c&&c.cookies.set(T),m&&m.cookies.set(T),A&&A().set(T);return}var t,s,n;if(l){var p=l,c=p.req,m=p.res,M=h(p,["req","res"]);s=c,n=m,t=M}var k=(0,a.serialize)(o,x(r),f({path:"/"},t));if(C())document.cookie=k;else if(n&&s){var j=n.getHeader("Set-Cookie");if(Array.isArray(j)||(j=j?[String(j)]:[]),n.setHeader("Set-Cookie",j.concat(k)),s&&s.cookies){var _=s.cookies;r===""?delete _[o]:_[o]=x(r)}if(s&&s.headers&&s.headers.cookie){var _=(0,a.parse)(s.headers.cookie);r===""?delete _[o]:_[o]=x(r),s.headers.cookie=Object.entries(_).reduce(function(R,G){return R.concat("".concat(G[0],"=").concat(G[1],";"))},"")}}};i.setCookie=w;var P=function(o,r){return(0,i.setCookie)(o,"",f(f({},r),{maxAge:-1}))};i.deleteCookie=P;var E=function(o,r){if(!o)return!1;var l=(0,i.getCookies)(r);return l.hasOwnProperty(o)};i.hasCookie=E})(Q);const re=S.createContext(void 0);function ae(){const i=S.useContext(re);if(i===void 0)throw new Error("useAuthContext must be used within an AuthProvider");return i}const ne=["App","IPTV","Streaming","VOD","Subscription","OTP","Programming","Other"],le=["Pending","In-Progress","Completed"],Oe=()=>{const[i,f]=K(),{showNotification:h}=W(),{user:a}=ae(),[C,g]=S.useState([]),[d,v]=S.useState(!0),[x,b]=S.useState(new Map),[u,B]=S.useState({page:parseInt(i.get("page"))||1,pageSize:20,total:0,pages:0}),[w,P]=S.useState({search:i.get("search")||"",issue_category:i.get("issue_category")||"",resolution_status:i.get("resolution_status")||"",agent_id:i.get("agent_id")||"",from:i.get("from")||"",to:i.get("to")||""});S.useEffect(()=>{(async()=>{try{const s=await Y.getEmployees({pageSize:1e3}),n=new Map;s.data.forEach(p=>{n.set(p.employee_id,p.name)}),b(n)}catch(s){console.error("Failed to load employees:",s)}})()},[]);const E=async()=>{try{v(!0);const t={page:u.page,pageSize:u.pageSize,...Object.fromEntries(Object.entries(w).filter(([n,p])=>p))},s=await D.getTickets(t);g(s.data||[]),B(n=>({...n,total:s.meta.total,pages:s.meta.pages}))}catch(t){h({message:t.message||"Failed to load tickets",variant:"danger"})}finally{v(!1)}};S.useEffect(()=>{E()},[u.page,i]);const o=()=>{const t=new URLSearchParams;t.set("page","1"),Object.entries(w).forEach(([s,n])=>{n&&t.set(s,n)}),f(t),B(s=>({...s,page:1}))},r=t=>{const s=new URLSearchParams(i);s.set("page",t),f(s),B(n=>({...n,page:t}))},l=async()=>{const t=n=>({App:["Login Issues","App Crashes","Performance Issues","Update Problems","Other"],IPTV:["Channel Issues","Streaming Problems","Audio/Video Issues","Remote Control","Other"],Streaming:["Buffering","Quality Issues","Connection Problems","Content Not Loading","Other"],VOD:["Video Not Playing","Search Issues","Download Problems","Subtitles","Other"],Subscription:["Payment Issues","Billing Problems","Account Access","Renewal Issues","Other"],OTP:["SMS Not Received","Code Expired","Wrong Number","Multiple Attempts","Other"],Programming:["Schedule Issues","Missing Content","Wrong Time","Repeats","Other"],Other:["General Inquiry","Technical Support","Account Help","Billing","Other"]})[n]||["Other"],s=await I.fire({title:"Add New Ticket",html:`
          <div class="text-start">
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Customer Phone *</label>
                  <input id="swal-phone" class="form-control" type="text" placeholder="Enter phone number" />
                </div>
                <div class="mb-3">
                  <label class="form-label">Communication Channel</label>
                  <select id="swal-channel" class="form-select">
                    <option value="">Select channel...</option>
                    <option value="WhatsApp">WhatsApp</option>
                    <option value="Phone">Phone</option>
                    <option value="Email">Email</option>
                    <option value="In-App">In-App</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Device Type</label>
                  <select id="swal-device" class="form-select">
                    <option value="">Select device...</option>
                    <option value="Huawei">Huawei</option>
                    <option value="Samsung">Samsung</option>
                    <option value="iOS">iOS</option>
                    <option value="Android">Android</option>
                    <option value="Smart TV">Smart TV</option>
                    <option value="IPTV Box">IPTV Box</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Customer Location</label>
                  <input id="swal-location" class="form-control" type="text" placeholder="Enter location" />
                </div>
                <div class="mb-3">
                  <label class="form-label">Issue Category *</label>
                  <select id="swal-category" class="form-select">
                    <option value="">Select category...</option>
                    <option value="App">App</option>
                    <option value="IPTV">IPTV</option>
                    <option value="Streaming">Streaming</option>
                    <option value="VOD">VOD</option>
                    <option value="Subscription">Subscription</option>
                    <option value="OTP">OTP</option>
                    <option value="Programming">Programming</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Issue Type</label>
                  <select id="swal-type" class="form-select" disabled>
                    <option value="">Select issue type...</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Issue Description</label>
              <textarea id="swal-description" class="form-control" rows="3" placeholder="Enter description..."></textarea>
            </div>
            ${a!=null&&a.id?'<div class="text-muted small">Assigned to: You</div>':""}
          </div>
        `,width:"800px",heightAuto:!1,showCancelButton:!0,confirmButtonText:"Create",cancelButtonText:"Cancel",confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",allowOutsideClick:!1,allowEscapeKey:!0,didOpen:()=>{const n=document.getElementById("swal-category"),p=document.getElementById("swal-type");n.addEventListener("change",k=>{const j=k.target.value,_=t(j);p.innerHTML='<option value="">Select issue type...</option>',_.forEach(U=>{const R=document.createElement("option");R.value=U,R.textContent=U,p.appendChild(R)}),p.disabled=!j,j||(p.value="")}),document.querySelector(".swal2-html-container").addEventListener("keydown",k=>{if(k.key==="Enter"&&!k.shiftKey){k.preventDefault();const j=document.querySelector(".swal2-confirm");j&&j.click()}})},preConfirm:()=>{const n=document.getElementById("swal-phone").value.trim(),p=document.getElementById("swal-category").value,M=document.getElementById("swal-description").value.trim();return!n||!p?(I.showValidationMessage("Customer Phone and Issue Category are required."),n?p||document.getElementById("swal-category").focus():document.getElementById("swal-phone").focus(),!1):{customer_phone:n,customer_location:document.getElementById("swal-location").value.trim(),communication_channel:document.getElementById("swal-channel").value,device_type:document.getElementById("swal-device").value,issue_category:p,issue_type:document.getElementById("swal-type").value,issue_description:M,agent_id:(a==null?void 0:a.id)||null}}});if(s.isConfirmed)try{await D.createTicket(s.value),I.fire({toast:!0,position:"top-end",icon:"success",title:"Ticket created successfully.",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),E()}catch(n){I.fire({title:"Couldn't create ticket",text:n.message||"An error occurred while creating the ticket.",icon:"error",confirmButtonText:"OK"})}},c=async t=>{try{await D.updateTicket(t.ticket_id,{resolution_status:"In-Progress"}),h({message:"Saved successfully.",variant:"success"}),E()}catch(s){h({message:s.message,variant:"danger"})}},m=async t=>{if((await I.fire({title:"Mark ticket as Completed?",text:"A follow-up will be created for customer confirmation.",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, Complete",cancelButtonText:"Cancel",confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d"})).isConfirmed)try{await D.updateTicket(t.ticket_id,{resolution_status:"Completed"}),h({message:"Follow-up created.",variant:"success"}),E()}catch(n){h({message:n.message,variant:"danger"})}},A=async t=>{const s=t.agent_name||"the agent";if((await I.fire({title:"Reopen ticket?",text:`It will return to ${s} to resolve again.`,icon:"warning",showCancelButton:!0,confirmButtonText:"Reopen",cancelButtonText:"Cancel",confirmButtonColor:"#ffc107",cancelButtonColor:"#6c757d"})).isConfirmed)try{await D.updateTicket(t.ticket_id,{resolution_status:"Pending",first_call_resolution:"No"}),h({message:"Saved successfully.",variant:"success"}),E()}catch(p){h({message:p.message,variant:"danger"})}},N=t=>({Open:"warning",Closed:"success",Reopened:"danger"})[t]||"secondary",T=t=>({Pending:"secondary","In-Progress":"info",Completed:"success"})[t]||"secondary";return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Tickets",breadcrumbItems:[{label:"Customer Support",path:"/support/tickets",active:!1},{label:"Tickets",path:"/support/tickets",active:!0}]}),e.jsx(H,{children:e.jsx(O,{xs:12,children:e.jsx($,{children:e.jsxs($.Body,{children:[e.jsxs(H,{className:"mb-3",children:[e.jsx(O,{md:2,children:e.jsxs(y.Group,{children:[e.jsx(y.Label,{children:"Search"}),e.jsx(y.Control,{type:"text",placeholder:"Phone or Ticket ID",value:w.search,onChange:t=>P(s=>({...s,search:t.target.value})),onKeyPress:t=>t.key==="Enter"&&o()})]})}),e.jsx(O,{md:2,children:e.jsxs(y.Group,{children:[e.jsx(y.Label,{children:"Category"}),e.jsxs(y.Select,{value:w.issue_category,onChange:t=>P(s=>({...s,issue_category:t.target.value})),children:[e.jsx("option",{value:"",children:"All Categories"}),ne.map(t=>e.jsx("option",{value:t,children:t},t))]})]})}),e.jsx(O,{md:2,children:e.jsxs(y.Group,{children:[e.jsx(y.Label,{children:"Status"}),e.jsxs(y.Select,{value:w.resolution_status,onChange:t=>P(s=>({...s,resolution_status:t.target.value})),children:[e.jsx("option",{value:"",children:"All Statuses"}),le.map(t=>e.jsx("option",{value:t,children:t},t))]})]})}),e.jsx(O,{md:2,children:e.jsxs(y.Group,{children:[e.jsx(y.Label,{children:"From Date"}),e.jsx(y.Control,{type:"date",value:w.from,onChange:t=>P(s=>({...s,from:t.target.value}))})]})}),e.jsx(O,{md:2,children:e.jsxs(y.Group,{children:[e.jsx(y.Label,{children:"To Date"}),e.jsx(y.Control,{type:"date",value:w.to,onChange:t=>P(s=>({...s,to:t.target.value}))})]})}),e.jsx(O,{md:1,className:"d-flex align-items-end",children:e.jsx(L,{onClick:o,variant:"danger",className:"w-100",children:"Filter"})}),e.jsx(O,{md:1,className:"d-flex align-items-end",children:e.jsxs(L,{variant:"danger",onClick:l,className:"w-100 d-flex align-items-center justify-content-center gap-1",style:{fontSize:"0.8rem"},children:[e.jsx("i",{className:"mdi mdi-plus-circle"}),"Add New"]})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover table-nowrap mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Channel"}),e.jsx("th",{children:"Device"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Issue Type"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Agent"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"FCR"}),e.jsx("th",{children:"State"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:d?e.jsx("tr",{children:e.jsx("td",{colSpan:"13",className:"text-center py-4",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})}):C.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"13",className:"text-center py-4 text-muted",children:"No tickets found"})}):C.map(t=>{var s,n;return e.jsxs("tr",{children:[e.jsxs("td",{children:["#",t.ticket_id]}),e.jsx("td",{children:new Date(t.createdAt).toLocaleDateString()}),e.jsxs("td",{children:[e.jsx("div",{children:t.customer_phone}),t.customer_location&&e.jsx("small",{className:"text-muted",children:t.customer_location})]}),e.jsx("td",{children:t.communication_channel||"-"}),e.jsx("td",{children:t.device_type||"-"}),e.jsx("td",{children:e.jsx(q,{bg:"primary",className:"bg-opacity-10 text-primary",children:t.issue_category})}),e.jsx("td",{children:t.issue_type||"-"}),e.jsx("td",{children:e.jsxs("span",{title:t.issue_description,children:[(s=t.issue_description)==null?void 0:s.substring(0,50),((n=t.issue_description)==null?void 0:n.length)>50&&"..."]})}),e.jsx("td",{children:t.agent_name||"Unassigned"}),e.jsx("td",{children:e.jsx(q,{bg:T(t.resolution_status),children:t.resolution_status})}),e.jsx("td",{children:e.jsx(q,{bg:t.first_call_resolution==="Yes"?"success":"secondary",children:t.first_call_resolution})}),e.jsx("td",{children:e.jsx(q,{bg:N(t.ticket_state),children:t.ticket_state})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-1",children:[t.resolution_status==="Pending"&&e.jsx(L,{size:"sm",variant:"info",onClick:()=>c(t),title:"Mark In-Progress",children:e.jsx("i",{className:"mdi mdi-progress-clock"})}),t.resolution_status==="In-Progress"&&e.jsx(L,{size:"sm",variant:"success",onClick:()=>m(t),title:"Mark Completed",children:e.jsx("i",{className:"mdi mdi-check-circle"})}),t.ticket_state==="Closed"&&e.jsx(L,{size:"sm",variant:"warning",onClick:()=>A(t),title:"Reopen",children:e.jsx("i",{className:"mdi mdi-restore"})})]})})]},t.ticket_id)})})]})}),u.pages>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",(u.page-1)*u.pageSize+1," to"," ",Math.min(u.page*u.pageSize,u.total)," of"," ",u.total," tickets"]}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination mb-0",children:[e.jsx("li",{className:`page-item ${u.page===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>r(u.page-1),disabled:u.page===1,children:"Previous"})}),[...Array(u.pages)].map((t,s)=>e.jsx("li",{className:`page-item ${u.page===s+1?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>r(s+1),children:s+1})},s)),e.jsx("li",{className:`page-item ${u.page===u.pages?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>r(u.page+1),disabled:u.page===u.pages,children:"Next"})})]})})]})]})})})})]})};export{Oe as default};
